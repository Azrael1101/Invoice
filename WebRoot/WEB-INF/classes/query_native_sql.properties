#---------------------------#
#        IM_MOVEMENT        #
#---------------------------#
FindWarehouseBelong2Employee = SELECT W.WAREHOUSE_CODE, W.WAREHOUSE_NAME, W.WAREHOUSE_MANAGER, W.WAREHOUSE_MANAGER_NAME, W.ALLOW_MINUS_STOCK, W.CUSTOMS_WAREHOUSE_CODE,W.LOCATION_ID, L.CITY, L.ZIP_CODE ,L.AREA, L.ADDRESS FROM (SELECT W.WAREHOUSE_CODE, W.WAREHOUSE_NAME, W.WAREHOUSE_MANAGER, E.CHINESE_NAME AS WAREHOUSE_MANAGER_NAME, W.ALLOW_MINUS_STOCK, W.CUSTOMS_WAREHOUSE_CODE,W.LOCATION_ID FROM ERP.IM_WAREHOUSE W, ERP.IM_WAREHOUSE_EMPLOYEE M, ERP.BU_EMPLOYEE_WITH_ADDRESS_VIEW E WHERE 1=1 AND W.BRAND_CODE = {#brandCode} AND W.ENABLE = {#enable} AND W.WAREHOUSE_CODE = M.WAREHOUSE_CODE AND W.WAREHOUSE_MANAGER = E.EMPLOYEE_CODE AND M.Employee_Code = {#employeeCode}  AND W.Warehouse_Code = {#warehouseCode} ) W, ERP.BU_LOCATION L WHERE 1=1 AND W.LOCATION_ID = L.LOCATION_ID(+) 
FindWarehouseBelong2EmployeeFields=WAREHOUSE_CODE,WAREHOUSE_NAME,WAREHOUSE_MANAGER,WAREHOUSE_MANAGER_NAME,ALLOW_MINUS_STOCK,LOCATION_ID,CITY,ZIP_CODE,AREA,ADDRESS,CUSTOMS_WAREHOUSE_CODE

FindArrivalWarehouse = SELECT W.WAREHOUSE_CODE, W.WAREHOUSE_NAME, W.WAREHOUSE_MANAGER, W.WAREHOUSE_MANAGER_NAME,W.ALLOW_MINUS_STOCK,  W.CUSTOMS_WAREHOUSE_CODE,W.LOCATION_ID, L.CITY, L.ZIP_CODE ,L.AREA, L.ADDRESS FROM  (SELECT W.WAREHOUSE_CODE, W.WAREHOUSE_NAME, W.WAREHOUSE_MANAGER, E.CHINESE_NAME AS WAREHOUSE_MANAGER_NAME, W.ALLOW_MINUS_STOCK,W.LOCATION_ID,W.CUSTOMS_WAREHOUSE_CODE FROM ERP.IM_WAREHOUSE W, ERP.BU_EMPLOYEE_WITH_ADDRESS_VIEW E WHERE 1=1 AND W.BRAND_CODE = {#brandCode} AND W.ENABLE = {#enable} AND W.Warehouse_Code = {#warehouseCode} AND W.WAREHOUSE_MANAGER = E.EMPLOYEE_CODE ) W, ERP.BU_LOCATION L WHERE 1=1 AND W.LOCATION_ID = L.LOCATION_ID(+) ORDER BY WAREHOUSE_CODE
FindArrivalWarehouseFields = WAREHOUSE_CODE,WAREHOUSE_NAME,WAREHOUSE_MANAGER,WAREHOUSE_MANAGER_NAME,ALLOW_MINUS_STOCK,LOCATION_ID,CITY,ZIP_CODE,AREA,ADDRESS,CUSTOMS_WAREHOUSE_CODE

FindCustomsWarehouse = SELECT W.WAREHOUSE_CODE, W.CUSTOMS_WAREHOUSE_CODE FROM ERP.IM_WAREHOUSE W WHERE 1=1 AND W.BRAND_CODE = {#brandCode} AND W.ENABLE = {#enable} AND W.Warehouse_Code = {#warehouseCode}
FindCustomsWarehouseFields = WAREHOUSE_CODE,CUSTOMS_WAREHOUSE_CODE


#FindItemInformationWithoutLotNo = SELECT H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO, H.CURRENT_ON_HAND_QTY, H.ITEM_CATEGORY,I.IS_TAX, H.CATEGORY01, H.CATEGORY02 FROM ERP.IM_ITEM_EAN_PRICE_VIEW I, ERP.IM_ITEM_ON_HAND_VIEW H, ERP.IM_WAREHOUSE_EMPLOYEE E WHERE 1=1 AND I.BRAND_CODE = H.BRAND_CODE AND I.ITEM_CODE = H.ITEM_CODE AND H.WAREHOUSE_CODE = E.WAREHOUSE_CODE AND I.BRAND_CODE = {#brandCode} AND I.EAN_CODE ={#itemCode} AND H.WAREHOUSE_CODE = {#warehouseCode} AND H.WAREHOUSE_MANAGER = {#warehouseManager} AND E.EMPLOYEE_CODE = {#employeeCode} AND H.CURRENT_ON_HAND_QTY <> 0  ORDER BY H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO ASC
#FindItemInformationWithoutLotNo = SELECT H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO, H.CURRENT_ON_HAND_QTY, H.ITEM_CATEGORY,I.IS_TAX, H.CATEGORY01, H.CATEGORY02 FROM ERP.IM_ITEM_EAN_PRICE_VIEW I, ERP.IM_ITEM_ON_HAND_VIEW H, ERP.IM_WAREHOUSE_EMPLOYEE E WHERE 1=1 AND I.BRAND_CODE = H.BRAND_CODE AND I.ITEM_CODE = H.ITEM_CODE AND H.WAREHOUSE_CODE = E.WAREHOUSE_CODE AND I.BRAND_CODE = {#brandCode} AND I.EAN_CODE ={#itemCode} AND H.WAREHOUSE_CODE = {#warehouseCode} AND E.EMPLOYEE_CODE = {#employeeCode} AND H.CURRENT_ON_HAND_QTY <>0 ORDER BY H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO ASC
FindItemInformationWithoutLotNo = SELECT I.ITEM_CODE, I.ITEM_C_NAME, I.IS_TAX, T.ITEM_CATEGORY, T.CATEGORY01, T.CATEGORY02,NVL(H.WAREHOUSE_CODE,{#warehouseCode}) AS WAREHOUSE_CODE, NVL(H.LOT_NO,'000000000000') AS LOT_NO, NVL( H.CURRENT_ON_HAND_QTY, 0) AS CURRENT_ON_HAND_QTY FROM IM_ITEM_EAN_PRICE_VIEW I, IM_ITEM T,(SELECT H.BRAND_CODE, H.ITEM_CODE, H.WAREHOUSE_CODE, H.LOT_NO, H.CURRENT_ON_HAND_QTY FROM ERP.IM_ITEM_EAN_PRICE_VIEW I, ERP.IM_ITEM_ON_HAND_VIEW H WHERE 1=1 AND I.BRAND_CODE = H.BRAND_CODE AND I.ITEM_CODE = H.ITEM_CODE AND I.BRAND_CODE ={#brandCode} AND I.EAN_CODE ={#itemCode} AND I.EAN_ENABLE='Y' AND H.WAREHOUSE_CODE = {#warehouseCode} AND H.CURRENT_ON_HAND_QTY <>0) H WHERE 1=1 AND I.BRAND_CODE = T.BRAND_CODE AND I.ITEM_CODE = T.ITEM_CODE AND I.BRAND_CODE = H.BRAND_CODE(+) AND I.ITEM_CODE = H.ITEM_CODE(+) AND I.BRAND_CODE ={#brandCode} AND I.EAN_CODE ={#itemCode} AND I.EAN_ENABLE='Y' AND I.ITEM_ENABLE='Y' ORDER BY I.ITEM_CODE, I.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO ASC
FindItemInformationWithoutLotNoFields = ITEM_CODE,ITEM_C_NAME,IS_TAX,ITEM_CATEGORY,CATEGORY01,CATEGORY02,WAREHOUSE_CODE,LOT_NO,CURRENT_ON_HAND_QTY,

FindItemInformationWithoutLotNoEanCode = SELECT O.ITEM_CODE,  O.ITEM_C_NAME,  O.IS_TAX,  O.ITEM_CATEGORY,  O.CATEGORY01,  O.CATEGORY02, NVL(O.WAREHOUSE_CODE, 'T1GS23') AS WAREHOUSE_CODE,  NVL(O.LOT_NO,'000000000000') AS LOT_NO, NVL( O.CURRENT_ON_HAND_QTY, 0) AS CURRENT_ON_HAND_QTY  FROM IM_ITEM_ON_HAND_VIEW O, IM_ITEM I WHERE 1=1   AND O.ITEM_CODE = I.ITEM_CODE  AND O.BRAND_CODE = I.BRAND_CODE  AND O.BRAND_CODE ={#brandCode}  AND O.ITEM_CODE ={#itemCode}  AND O.WAREHOUSE_CODE = {#warehouseCode} AND I.ENABLE='Y'  ORDER BY O.ITEM_CODE, O.ITEM_C_NAME, O.WAREHOUSE_CODE, O.LOT_NO ASC 
FindItemInformationWithoutLotNoEanCodeFields = ITEM_CODE,ITEM_C_NAME,IS_TAX,ITEM_CATEGORY,CATEGORY01,CATEGORY02,WAREHOUSE_CODE,LOT_NO,CURRENT_ON_HAND_QTY,

#FindItemInformationWithLotNo = SELECT H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO, H.CURRENT_ON_HAND_QTY, H.ITEM_CATEGORY,I.IS_TAX, H.CATEGORY01, H.CATEGORY02 FROM ERP.IM_ITEM_EAN_PRICE_VIEW I, ERP.IM_ITEM_ON_HAND_VIEW H, ERP.IM_WAREHOUSE_EMPLOYEE E WHERE 1=1 AND I.BRAND_CODE = H.BRAND_CODE AND I.ITEM_CODE = H.ITEM_CODE AND H.WAREHOUSE_CODE = E.WAREHOUSE_CODE AND I.BRAND_CODE = {#brandCode} AND I.EAN_CODE ={#itemCode} AND H.WAREHOUSE_CODE = {#warehouseCode} AND H.LOT_NO = {#lotNo} AND H.WAREHOUSE_MANAGER = {#warehouseManager} AND E.EMPLOYEE_CODE = {#employeeCode} ORDER BY H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO ASC
FindItemInformationWithLotNo = SELECT H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO, H.CURRENT_ON_HAND_QTY, H.ITEM_CATEGORY,I.IS_TAX, H.CATEGORY01, H.CATEGORY02 FROM ERP.IM_ITEM_EAN_PRICE_VIEW I, ERP.IM_ITEM_ON_HAND_VIEW H, ERP.IM_WAREHOUSE_EMPLOYEE E WHERE 1=1 AND I.BRAND_CODE = H.BRAND_CODE AND I.ITEM_CODE = H.ITEM_CODE AND H.WAREHOUSE_CODE = E.WAREHOUSE_CODE AND I.BRAND_CODE = {#brandCode} AND I.EAN_CODE ={#itemCode} AND I.EAN_ENABLE='Y' AND I.ITEM_ENABLE='Y' AND H.WAREHOUSE_CODE = {#warehouseCode} AND H.LOT_NO = {#lotNo}  AND E.EMPLOYEE_CODE = {#employeeCode} ORDER BY H.ITEM_CODE, H.ITEM_C_NAME, H.WAREHOUSE_CODE, H.LOT_NO ASC  
FindItemInformationWithLotNoFields = ITEM_CODE,ITEM_C_NAME,WAREHOUSE_CODE,LOT_NO,CURRENT_ON_HAND_QTY,ITEM_CATEGORY,IS_TAX,CATEGORY01,CATEGORY02

FindMovementBoxCount = SELECT HEAD_ID, NVL(MAX(BOX_NO),0) AS BOX_COUNT FROM IM_MOVEMENT_ITEM WHERE HEAD_ID={#headId} AND IS_DELETE_RECORD <> 1 GROUP BY HEAD_ID
FindMovementBoxCountFields = HEAD_ID,BOX_COUNT

FindMovementItemCount = SELECT SUM(NVL(ORIGINAL_DELIVERY_QUANTITY,0)) AS ORIGINAL_DELIVERY_QUANTITY, SUM(NVL(DELIVERY_QUANTITY,0)) AS DELIVERY_QUANTITY, SUM(NVL(ARRIVAL_QUANTITY,0)) AS ARRIVAL_QUANTITY  FROM IM_MOVEMENT_ITEM WHERE HEAD_ID={#headId} AND IS_DELETE_RECORD <> 1 
FindMovementItemCountFields = ORIGINAL_DELIVERY_QUANTITY, DELIVERY_QUANTITY,ARRIVAL_QUANTITY

FindTheFirstItemCategory = SELECT L.ITEM_CODE, L.DELIVERY_WAREHOUSE_CODE, L.ARRIVAL_WAREHOUSE_CODE,I.ITEM_CATEGORY FROM IM_MOVEMENT_ITEM L, IM_ITEM I  WHERE L.HEAD_ID = {#headId} AND L.INDEX_NO=1 AND {#brandCode} = I.BRAND_CODE(+) AND L.ITEM_CODE = I.ITEM_CODE(+)
FindTheFirstItemCategoryFields = ITEM_CODE,DELIVERY_WAREHOUSE_CODE,ARRIVAL_WAREHOUSE_CODE,ITEM_CATEGORY

FindEmployeeChineseName = select  buemployee0_.EMPLOYEE_CODE ,buemployee0_.CHINESE_NAME from ERP.BU_EMPLOYEE_WITH_ADDRESS_VIEW buemployee0_ where buemployee0_.EMPLOYEE_CODE={#employeeCode}
FindEmployeeChineseNameFields = EMPLOYEE_CODE, CHINESE_NAME

FindSupplierChineseName = SELECT S.CHINESE_NAME, S.CURRENCY_CODE FROM BU_SUPPLIER_WITH_ADDRESS_VIEW S WHERE S.SUPPLIER_CODE={#supplierCode} AND S.BRAND_CODE={#brandCode}
FindSupplierChineseNameFields = CHINESE_NAME,CURRENCY_CODE

FindItemByItemCode = select ITEM_CODE,BRAND_CODE,ITEM_C_NAME,ITEM_E_NAME,ITEM_LEVEL,LOT_CONTROL,SUPPLIER_ITEM_CODE,RELEASE_DATE,EXPIRY_DATE,FOREIGN_LIST_PRICE,SUPPIER_QUOTATION_PRICE,STANDARD_PURCHASE_COST,IS_COMPOSE_ITEM,IS_SERVICE_ITEM,SPEC_LENGTH,SPEC_WIDTH,SPEC_HEIGHT,SPEC_WEIGHT,SALES_RATIO,SALES_UNIT,PURCHASE_UNIT,PURCHASE_RATIO,BOX_CAPACITY,DESCRIPTION,CATEGORY01,CATEGORY02,CATEGORY03,CATEGORY04,CATEGORY05,CATEGORY06,CATEGORY07,CATEGORY08,CATEGORY09,CATEGORY10,CATEGORY11,CATEGORY12,CATEGORY13,CATEGORY14,CATEGORY15,CATEGORY16,CATEGORY17,CATEGORY18,CATEGORY19,CATEGORY20,ENABLE from im_item where item_code = {#itemCode} and brand_code ={#brandCode}
FindItemByItemCodeFields = ITEM_CODE,BRAND_CODE,ITEM_C_NAME,ITEM_E_NAME,ITEM_LEVEL,LOT_CONTROL,SUPPLIER_ITEM_CODE,RELEASE_DATE,EXPIRY_DATE,FOREIGN_LIST_PRICE,SUPPIER_QUOTATION_PRICE,STANDARD_PURCHASE_COST,IS_COMPOSE_ITEM,IS_SERVICE_ITEM,SPEC_LENGTH,SPEC_WIDTH,SPEC_HEIGHT,SPEC_WEIGHT,SALES_RATIO,SALES_UNIT,PURCHASE_UNIT,PURCHASE_RATIO,BOX_CAPACITY,DESCRIPTION,CATEGORY01,CATEGORY02,CATEGORY03,CATEGORY04,CATEGORY05,CATEGORY06,CATEGORY07,CATEGORY08,CATEGORY09,CATEGORY10,CATEGORY11,CATEGORY12,CATEGORY13,CATEGORY14,CATEGORY15,CATEGORY16,CATEGORY17,CATEGORY18,CATEGORY19,CATEGORY20,ENABLE

FindWarehouseManager = SELECT C.ATTRIBUTE1 AS EMPLOYEE_CODE, E.CHINESE_NAME FROM BU_COMMON_PHRASE_LINE C, BU_EMPLOYEE_WITH_ADDRESS_VIEW E WHERE C.HEAD_CODE ='WarehouseManagerByCategory' AND C.LINE_CODE ={#itemCategoryKey} AND C.ATTRIBUTE1 = E.EMPLOYEE_CODE
FindWarehouseManagerFields = EMPLOYEE_CODE,CHINESE_NAME

FindPromotionItem = SELECT I.ITEM_C_NAME, I.UNIT_PRICE, ROUND(NVL(COST.AVERAGE_UNIT_COST, I.STANDARD_PURCHASE_COST),0) COST_AMOUNT,CASE WHEN TO_NUMBER({#discountAmount}) <> 0 THEN TO_NUMBER({#discountAmount}) ELSE ROUND(I.UNIT_PRICE * (TO_NUMBER({#discountPercentage})/100),0) END AS TOTAL_DISACOUNT_AMOUNT,CASE WHEN TO_NUMBER({#discountAmount}) <> 0 THEN ROUND((TO_NUMBER({#discountAmount})/I.UNIT_PRICE) * 100,2)ELSE 100-TO_NUMBER({#discountPercentage}) END AS TOTAL_DISCOUNT_PERCENTAGE FROM im_item_current_price_view I,(SELECT ITEM_CODE, AVERAGE_UNIT_COST FROM (SELECT YEAR ||MONTH, ITEM_CODE,AVERAGE_UNIT_COST FROM IM_MONTHLY_BALANCE_HEAD M WHERE M.BRAND_CODE={#brandCode} AND M.ITEM_CODE ={#itemCode} ORDER BY M.YEAR ||M.MONTH DESC) WHERE ROWNUM = 1) COST WHERE I.BRAND_CODE={#brandCode} AND I.ITEM_CODE ={#itemCode} AND I.ITEM_CODE = COST.ITEM_CODE(+)
FindPromotionItemFields = ITEM_C_NAME, UNIT_PRICE, COST_AMOUNT, TOTAL_DISACOUNT_AMOUNT, TOTAL_DISCOUNT_PERCENTAGE


FindPromotionShop =SELECT S.SHOP_CODE, S.SHOP_C_NAME FROM BU_SHOP S WHERE S.BRAND_CODE ={#brandCode}  AND S.SHOP_CODE ={#shopCode}
FindPromotionShopFields = SHOP_CODE, SHOP_C_NAME

FindPriceAdjustmentItem =SELECT ITEM_C_NAME, SUPPIER_QUOTATION_PRICE, UNIT_PRICE FROM IM_ITEM_CURRENT_PRICE_VIEW WHERE BRAND_CODE ={#brandCode} AND ITEM_CODE ={#itemCode} AND TYPE_CODE ={#priceType}
FindPriceAdjustmentItemFields = ITEM_C_NAME,SUPPIER_QUOTATION_PRICE,UNIT_PRICE

FindPriceSettingItem =SELECT ITEM_CODE, NVL(ITEM_C_NAME,' ') AS ITEM_C_NAME, PRICE_ID, CATEGORY13, SUPPIER_QUOTATION_PRICE AS FOREIGN_COST, (NVL(SUPPIER_QUOTATION_PRICE,0)  * {#exchangeRate} * {#ratio}) AS LOCAL_COST, ROUND((NVL(SUPPIER_QUOTATION_PRICE,0) * {#exchangeRate} * {#ratio} /UNIT_PRICE) * 100,2) AS COST_RATE , UNIT_PRICE FROM IM_ITEM_PRICE_VIEW WHERE BRAND_CODE ={#brandCode} AND ITEM_CODE ={#itemCode}  AND TYPE_CODE ={#priceType} AND PRICE_ENABLE='N' AND ITEM_ENABLE='Y'
FindPriceSettingItemFields = ITEM_CODE,ITEM_C_NAME,PRICE_ID,CATEGORY13,FOREIGN_COST,LOCAL_COST, COST_RATE,UNIT_PRICE

Round = SELECT {#rounded} AS ROUNDED, ROUND({#rounded},{#fraction}) AS RESULT FROM DUAL
RoundFields = ROUNDED, RESULT

findAssignee = SELECT ROWNUM, ERP.GET_CEAP_ASSIGN_USERNAME({#brandCode},{#orderTypeCode},{#orderNo}) as ASSIGNEE_NAME FROM DUAL
findAssigneeFields = ROWNUM,ASSIGNEE_NAME

findMoveFirstRecord = SELECT L.ITEM_CODE, I.ITEM_CATEGORY FROM IM_MOVEMENT_ITEM L, IM_ITEM I WHERE L.HEAD_ID ={#headId} AND L.INDEX_NO = 1 AND I.BRAND_CODE ={#brandCode} AND L.ITEM_CODE = I.ITEM_CODE
findMoveFirstRecordFields = ITEM_CODE,ITEM_CATEGORY

FindEmployeeRole =  SELECT EMP.EMPLOYEE_CODE,EMP.EMPLOYEE_ROLE,EMP.COST_CONTROL,EMP.WAREHOUSE_CONTROL FROM BU_EMPLOYEE EMP WHERE EMP.EMPLOYEE_CODE = {#employeeCode}
FindEmployeeRoleFields = EMPLOYEE_CODE,EMPLOYEE_ROLE,COST_CONTROL,WAREHOUSE_CONTROL

#---------------------------#
#       IM_ADJUSTMENT       #
#---------------------------#
FindTheFirstCmDeclarationItemCustomsWarehouseCode = SELECT HEAD_ID, CUSTOMS_WAREHOUSE_CODE FROM IM_ADJUSTMENT_HEAD WHERE HEAD_ID = {#headId}
FindTheFirstCmDeclarationItemCustomsWarehouseCodeFields = HEAD_ID,CUSTOMS_WAREHOUSE_CODE